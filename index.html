<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Super Liga Chilena Pro</title>
    <style>
        body { margin: 0; overflow: hidden; background: #008ecc; font-family: sans-serif; touch-action: none; }
        #ui { position: absolute; width: 100%; top: 0; text-align: center; z-index: 10; color: white; pointer-events: none; }
        #selector { 
            position: absolute; inset: 0; background: #004766; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; 
        }
        .equipos { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn { 
            background: white; border: 4px solid #f1c40f; border-radius: 10px; 
            width: 80px; height: 80px; display: flex; align-items: center; 
            justify-content: center; cursor: pointer;
        }
        .btn img { max-width: 80%; max-height: 80%; pointer-events: none; }
        canvas { display: block; }
    </style>
</head>
<body>

<div id="ui">
    <h2 style="background:white; color:#008ecc; margin:0; padding:10px;">Super Liga Chilena</h2>
    <div id="score" style="background:#005a82; padding:5px;">ELIGE TU EQUIPO</div>
</div>

<div id="selector">
    <div class="equipos">
        <div class="btn" onclick="play(0)"><img src="uno.png"></div>
        <div class="btn" onclick="play(1)"><img src="colo.png"></div>
        <div class="btn" onclick="play(2)"><img src="uc.png"></div>
    </div>
    <b style="color:white;">TOCA UN ESCUDO</b>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const selector = document.getElementById("selector");
const scoreDisp = document.getElementById("score");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const files = ["uno.png", "colo.png", "uc.png"];
let playerImg = new Image();
let enemyImgs = [];
let active = false;
let score = 0;
let obs = [];

const p = { x: 50, y: 0, w: 60, h: 60, dy: 0, jump: 15, grav: 0.7, onG: false };

function play(idx) {
    // 1. Asignar imágenes
    playerImg.src = files[idx];
    enemyImgs = files.filter((_, i) => i !== idx).map(f => {
        let img = new Image();
        img.src = f;
        return img;
    });

    // 2. Limpiar y arrancar (Igual que el Máster)
    selector.style.display = "none";
    active = true;
    score = 0;
    obs = [];
    p.y = canvas.height - 150;
    scoreDisp.innerText = "GOLES: 0";
    
    requestAnimationFrame(update);
}

function update() {
    if (!active) return;

    p.dy += p.grav;
    p.y += p.dy;
    const floor = canvas.height - 50;

    if (p.y + p.h > floor) {
        p.y = floor - p.h;
        p.dy = 0;
        p.onG = true;
    }

    obs.forEach((o, i) => {
        o.x -= 6;
        // Colisión
        if (p.x < o.x + 40 && p.x + 40 > o.x && p.y + p.h > floor - 40) {
            active = false;
            alert("FIN DEL PARTIDO. GOLES: " + score);
            location.reload();
        }
        if (o.x + 50 < 0) { obs.splice(i, 1); score++; scoreDisp.innerText = "GOLES: " + score; }
    });

    // Dibujo
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#2ecc71";
    ctx.fillRect(0, floor, canvas.width, 50);

    ctx.drawImage(playerImg, p.x, p.y, p.w, p.h);
    obs.forEach(o => ctx.drawImage(o.img, o.x, floor - 50, 50, 50));

    requestAnimationFrame(update);
}

function jump() { if(p.onG && active) { p.dy = -p.jump; p.onG = false; } }

window.addEventListener("touchstart", (e) => { if(active) { e.preventDefault(); jump(); } }, {passive: false});
window.addEventListener("mousedown", jump);

setInterval(() => {
    if(active) {
        let rnd = enemyImgs[Math.floor(Math.random() * enemyImgs.length)];
        obs.push({ x: canvas.width, img: rnd });
    }
}, 1800);
</script>
</body>
</html>
