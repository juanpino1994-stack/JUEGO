<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Super Liga Chilena Pro</title>
    <style>
        body { margin: 0; overflow: hidden; background: #008ecc; font-family: sans-serif; touch-action: none; -webkit-user-select: none; }
        #ui { position: absolute; width: 100%; top: 0; text-align: center; z-index: 10; pointer-events: none; }
        .header { background: #fff; padding: 10px 0; color: #008ecc; font-size: 20px; font-weight: bold; }
        
        #selector { 
            position: absolute; inset: 0; background: #004766; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; 
        }
        .equipos { display: flex; gap: 15px; margin-bottom: 25px; }
        .btn { 
            background: white; border: 5px solid #f1c40f; border-radius: 15px; 
            width: 90px; height: 90px; display: flex; align-items: center; 
            justify-content: center; overflow: hidden; cursor: pointer;
        }
        .btn img { max-width: 80%; max-height: 80%; object-fit: contain; pointer-events: none; }
        
        /* BOTÓN DE DISPARO REFORZADO */
        #btnDisparo {
            position: absolute; bottom: 40px; right: 30px;
            width: 90px; height: 90px; border-radius: 50%;
            border: 5px solid white; display: none; z-index: 2000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.6);
            font-weight: bold; color: white; text-shadow: 2px 2px 2px black;
            align-items: center; justify-content: center; font-size: 18px;
            cursor: pointer; -webkit-tap-highlight-color: transparent;
        }

        canvas { display: block; }
    </style>
</head>
<body>

<div id="ui">
    <div class="header">Super Liga Chilena Pro</div>
    <div id="score" style="color: white; background: #005a82; padding: 5px;">ELIGE TU EQUIPO</div>
</div>

<div id="selector">
    <div class="equipos">
        <div class="btn" onclick="comenzar(0)"><img src="u.png"></div>
        <div class="btn" onclick="comenzar(1)"><img src="colo.png"></div>
        <div class="btn" onclick="comenzar(2)"><img src="uc.png"></div>
    </div>
    <b style="color:white; font-size: 18px;">PRESIONA PARA JUGAR</b>
</div>

<div id="btnDisparo">PUM!</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const selector = document.getElementById("selector");
const scoreDisp = document.getElementById("score");
const btnDisparo = document.getElementById("btnDisparo");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const archivos = ["u.png", "colo.png", "uc.png"];
let imgP = new Image();
let imgsE = [];
let activo = false;
let goles = 0;
let obs = [];
let balas = [];

const p = { x: 50, y: 0, w: 65, h: 65, dy: 0, salto: 16, grav: 0.8, suelo: false };

function comenzar(idx) {
    imgP.src = archivos[idx];
    imgsE = archivos.filter((_, i) => i !== idx).map(n => {
        let img = new Image();
        img.src = n;
        return img;
    });

    // Colores Bicolor según tu pedido
    if(idx === 0) btnDisparo.style.background = "linear-gradient(45deg, #0033a0 50%, #e10600 50%)";
    if(idx === 1) btnDisparo.style.background = "linear-gradient(45deg, #ffffff 50%, #000000 50%)";
    if(idx === 2) btnDisparo.style.background = "linear-gradient(45deg, #0033a0 50%, #ffffff 50%)";

    selector.style.display = "none";
    btnDisparo.style.display = "flex";
    activo = true;
    goles = 0;
    obs = [];
    balas = [];
    p.y = canvas.height - 150;
    p.dy = 0;
    scoreDisp.innerText = "GOLES: 0";
    
    requestAnimationFrame(loop);
}

// Función de disparo aislada para evitar fallos
function ejecutarDisparo() {
    if(activo) {
        balas.push({ x: p.x + p.w, y: p.y + p.h/2, r: 12 });
    }
}

// Listeners específicos para el botón
btnDisparo.addEventListener("touchstart", (e) => {
    e.preventDefault();
    e.stopPropagation();
    ejecutarDisparo();
}, {passive: false});

function loop() {
    if (!activo) return;

    p.dy += p.grav;
    p.y += p.dy;
    const ground = canvas.height - 60;

    if (p.y + p.h > ground) {
        p.y = ground - p.h;
        p.dy = 0;
        p.suelo = true;
    }

    // Balas
    balas.forEach((b, bi) => {
        b.x += 12;
        if(b.x > canvas.width) balas.splice(bi, 1);
        
        obs.forEach((o, oi) => {
            if(b.x > o.x && b.x < o.x + 60 && b.y > ground - 70) {
                obs.splice(oi, 1);
                balas.splice(bi, 1);
                goles++;
                scoreDisp.innerText = "GOLES: " + goles;
            }
        });
    });

    // Enemigos y Colisión
    obs.forEach((o, i) => {
        o.x -= 7;
        if (p.x < o.x + 40 && p.x + 40 > o.x && p.y + p.h > ground - 40) {
            finalizarJuego();
        }
        if (o.x + 100 < 0) obs.splice(i, 1);
    });

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#2ecc71";
    ctx.fillRect(0, ground, canvas.width, 60);

    if(imgP.complete) ctx.drawImage(imgP, p.x, p.y, p.w, p.h);
    
    ctx.fillStyle = "yellow";
    balas.forEach(b => {
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
        ctx.fill();
    });

    obs.forEach(o => { if(o.img.complete) ctx.drawImage(o.img, o.x, ground - 55, 55, 55); });

    requestAnimationFrame(loop);
}

function finalizarJuego() {
    activo = false;
    btnDisparo.style.display = "none";
    alert("PARTIDO TERMINADO\nGOLES: " + goles);
    // Forzamos el reinicio total para limpiar la memoria del Moto G
    window.location.reload();
}

function saltar() { if(p.suelo && activo) { p.dy = -p.salto; p.suelo = false; } }

// Salto táctil global (ignora el botón de disparo)
window.addEventListener("touchstart", (e) => { 
    if(activo && e.target.id !== "btnDisparo") { 
        e.preventDefault(); 
        saltar(); 
    } 
}, {passive: false});

// Generador de obstáculos
let spawntimer = setInterval(() => {
    if(activo) {
        let ri = imgsE[Math.floor(Math.random() * imgsE.length)];
        obs.push({ x: canvas.width, img: ri });
    }
}, 1800);
</script>
</body>
</html>
